# Lumencat AI Coding Agent Instructions

## Project Overview

**Lumencat** is a static, performance-optimized business website for a web design/automation/AI services agency. Built with vanilla HTML/CSS/JS with zero frameworks, emphasizing progressive enhancement, accessibility, and modern web standards (PWA, AVIF/WebP, ARIA).

**Repository:** Pixel-Mensch/LumenCat (branch: `dev`)  
**Deployment:** Hetzner Webhosting (PHP 7.4+, FTP/SFTP)

## Architecture & Design Principles

### 1. Modular CSS Architecture (Post-Migration)

The CSS was recently refactored from a monolithic 1958-line file into **16 specialized modules**:

```
css/
├── styles.css              # Entry point (only @imports)
├── styles.min.css          # Production build (auto-generated)
├── modules/                # 13 reusable component modules
│   ├── variables.css       # Theme tokens, CSS custom properties
│   ├── base.css            # Reset, body, focus styles
│   ├── navigation.css      # Mobile/desktop nav, theme toggle
│   ├── animations.css      # Scroll-reveal with IntersectionObserver
│   └── ...
└── pages/                  # Page-specific styles (shop.css, blog.css)
```

**Critical Rules:**

- **Never** edit `styles.min.css` directly (it's generated by `npm run build:css`)
- All changes go in module files (`css/modules/` or `css/pages/`)
- Use CSS custom properties from `variables.css` (e.g., `var(--color-accent-cyan)`)
- Follow existing naming patterns: `.component__element--modifier` (BEM-like)

### 2. Theme System with FOUC Prevention

The site uses a sophisticated dark/light theme system:

```javascript
// Inline <script> in <head> prevents flash of unstyled content
(function () {
  const theme =
    localStorage.getItem("lumencat-theme") === "light" ? "light" : "dark";
  document.documentElement.className = "theme-" + theme;
})();
```

- Theme class applied to **both** `<html>` and `<body>` (see `js/main.js`)
- Light mode overrides defined in `:root.theme-light` (see `css/modules/variables.css`)
- System preference fallback: `prefers-color-scheme: light`
- localStorage key: `lumencat-theme`

### 3. Accessibility-First Animation System

**Pattern:** Progressive enhancement with motion preferences

```javascript
// All animations respect prefers-reduced-motion
const prefersReducedMotion = window.matchMedia(
  "(prefers-reduced-motion: reduce)"
).matches;

if (prefersReducedMotion) {
  // Skip animations, immediately show content
  elements.forEach((el) => el.classList.add("reveal--visible"));
}
```

**Scroll-reveal pattern:**

- HTML: Add `.reveal` or `.reveal-fade` classes
- Delay variants: `.reveal-delay-1`, `.reveal-delay-2`, etc.
- IntersectionObserver triggers `.reveal--visible` at 16% threshold
- Default: reveal once (use `data-reveal-once="false"` to repeat)

### 4. Image Optimization Pipeline

Images are **never** manually converted. Always use the build script:

```powershell
npm run img:convert  # Processes Bilder/*.{png,jpg,jpeg}
```

**Output:** `Bilder/optimized/` contains:

- AVIF/WebP formats (AVIF preferred, WebP fallback)
- Responsive sizes: 480px, 800px, 1200px + original
- Quality settings: WebP 80/78, AVIF 50/45

**HTML pattern:**

```html
<picture>
  <source
    srcset="Bilder/optimized/image-480.avif 480w, ..."
    type="image/avif"
  />
  <source
    srcset="Bilder/optimized/image-480.webp 480w, ..."
    type="image/webp"
  />
  <img src="Bilder/image.png" alt="..." />
</picture>
```

## Developer Workflows

### Build Commands (package.json)

```powershell
npm run build         # Full build: images, sitemap, CSS, JS
npm run img:convert   # Sharp-based image optimization
npm run build:css     # Inline @imports + minify → styles.min.css
npm run build:js      # Basic minification → main.min.js
npm run sitemap       # Regenerate sitemap.xml
```

**Production deployment:** Use `.min` versions in HTML `<link>` and `<script>` tags.

### Contact Form Integration

`scripts/contact.php` handles form submission with:

1. **Environment-based configuration** via `.env` (never commit this file):
   ```env
   CONTACT_TO_EMAIL=hello@lumencat.de
   CONTACT_FROM_EMAIL=no-reply@lumencat.de
   N8N_WEBHOOK_URL=https://n8n.example.com/webhook/lumencat
   ```
2. **Honeypot spam protection:** Field named `website` (must be empty)
3. **Server-side validation:** Name, email (FILTER_VALIDATE_EMAIL), message required
4. **Multi-channel distribution:**
   - PHP `mail()` to configured email
   - Optional n8n webhook (cURL with 3s timeout)
   - JSON response for AJAX handling

**n8n automation flow (if configured):**

```
Contact form → contact.php → n8n webhook → KI analysis (OpenAI) → Google Sheets/CRM → Email/Telegram notifications
```

### Local Development Server

```powershell
# Option 1: Python (if installed)
python -m http.server 8000

# Option 2: PHP built-in server (required for contact form testing)
php -S localhost:8000

# Then visit: http://localhost:8000
```

**Testing contact form locally:** Requires PHP server + configured `.env` file.

## Conventions & Patterns

### HTML Structure

- **Semantic HTML5:** Use `<section>`, `<article>`, `<nav>`, not `<div>` soups
- **SEO meta tags:** All pages have Open Graph, Twitter Cards, structured data (JSON-LD)
- **ARIA attributes:** Theme toggle has `aria-pressed`, mobile menu has `aria-expanded`
- **Progressive Web App:** `manifest.json`, `sw.js` (service worker), apple-touch-icon

### JavaScript (Vanilla ES6+)

- **No frameworks/libraries** (except Sharp in Node scripts)
- **Event delegation pattern:** Used for mobile nav links
- **requestAnimationFrame:** For parallax effects (performance-critical)
- **Feature detection:** Check `IntersectionObserver` support before using

### CSS Naming

- **Components:** `.card`, `.btn`, `.hero`
- **Modifiers:** `.btn--primary`, `.card--featured`
- **Utilities:** `.text-center`, `.mt-lg` (spacing: `--space-lg`)
- **Animation classes:** `.reveal`, `.reveal--visible`, `.reveal-delay-N`

### File Organization

- **Scripts folder:** Node.js build tools (NOT deployed to production)
- **Bilder/:** Source images (PNG/JPG originals)
- **Bilder/optimized/:** Generated assets (gitignored, regenerate on deploy)
- **en/:** Placeholder for future internationalization

## Common Tasks

### Adding a New Page

1. Create `newpage.html` in root
2. Add page-specific styles to `css/pages/newpage.css`
3. Import in `css/styles.css`: `@import "pages/newpage.css";`
4. Add to `scripts/generate-sitemap.js` file list
5. Add to `sw.js` cache (if PWA-critical)
6. Run `npm run build` to regenerate minified CSS + sitemap

### Modifying Theme Colors

1. Edit `css/modules/variables.css` (both `:root` and `:root.theme-light`)
2. Use custom properties: `background: var(--color-bg);`
3. **Never** hardcode colors like `#000` or `#fff` in other modules

### Adding Scroll Animations

1. HTML: Add `.reveal` or `.reveal-fade` to element
2. Optional: Add `.reveal-delay-1` (increment for each element: 2, 3, etc.)
3. CSS: Define animation in `css/modules/animations.css` (see existing patterns)
4. No JavaScript changes needed (IntersectionObserver auto-detects)

### Debugging Contact Form

```powershell
# Check PHP error log
tail -f /path/to/error.log

# Test n8n webhook directly
curl -X POST https://n8n.example.com/webhook/test -H "Content-Type: application/json" -d '{"test":"data"}'
```

## Key Files to Reference

- **`README.md`**: Comprehensive project documentation, feature list, deployment guide
- **`CSS_MIGRATION.md`**: Details of CSS modularization, performance metrics
- **`css/README_MODULAR.md`**: Module-by-module breakdown of CSS architecture
- **`package.json`**: All build scripts and dependencies
- **`.env.example`** (create this): Template for environment variables

## Anti-Patterns (What NOT to Do)

❌ Don't edit `styles.min.css` or `main.min.js` directly  
❌ Don't add inline styles in HTML (use utility classes or new module)  
❌ Don't skip `npm run build` before production deployment  
❌ Don't commit `.env` file or `Bilder/optimized/` (regenerate on server)  
❌ Don't use JavaScript frameworks (jQuery, React, etc.) – maintain vanilla approach  
❌ Don't ignore `prefers-reduced-motion` when adding animations  
❌ Don't add CSS outside the modular structure (always use modules/pages folders)

## Questions to Ask if Unclear

1. **Performance:** Is this change AVIF/WebP optimized? Does it respect lazy loading?
2. **Accessibility:** Does this work with keyboard navigation? Screen readers? Reduced motion?
3. **Theme compatibility:** Does this look correct in both dark AND light modes?
4. **Build process:** Do I need to run `npm run build` after this change?
5. **Deployment:** Is this file included in production (not in `scripts/` or `node_modules/`)?
